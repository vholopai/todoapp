<html>
	<body>
		<!--   ${todoitem} -->
		
		<button onclick="addTodo('test todo item')">Add Todo</button>
		
		<div id="todoItems"></div>
		
		
		<script type="text/javascript">
		
			function post(okFunction, failFunction, uri, data) {

			    var xhttp = new XMLHttpRequest();
			    xhttp.onreadystatechange = function() {
			        if (this.readyState > 3 && this.status == 200) {
			        	okFunction(this);
			        }
			        else if (this.readyState > 3 && this.status == 404) {
			            failFunction(this);
			        }			        
			    };
			    xhttp.open("POST", uri); 
			    //xhttp.withCredentials = true; // false = synchronous
			    xhttp.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');
			    xhttp.send(data);
			}
			
			function getAllTodosCallback(data) {
				var obj;
				try {
					obj = JSON.parse(data.responseText);
				} catch (err) {
					console.log("Unable to parse JSON " + data.responseText);
					return;
				}
				var parentDiv = document.getElementById('todoItems');
				parentDiv.innerHTML = "";
				for (var key in obj) {
					if (obj.hasOwnProperty(key)) {
			    		var todoTxt = document.createTextNode(obj[key].msg);
			    		var newDiv = document.createElement("div");
			    		newDiv.appendChild(todoTxt);
			    		parentDiv.appendChild(newDiv);
					  	//alert(obj[key].id);
					  	//alert(obj[key].msg);
					}
				}	
			}
			
			function addTodo(content) {
				post(addTodoCallback, failCallback, "/addTodo", "text=" + encodeURIComponent(content));
			}
			
			function addTodoCallback() {
				alert("success");
			}
			
			function failCallback() {
				alert("failed");
			}
			
			// self executing function here
			(function() {
				post(getAllTodosCallback, failCallback, "/getAllTodos", "");
			})();
			
		</script>
		
	</body>
	
</html>