<html>
	<head>
		<!-- needed for basic style -->
		<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" integrity="sha384-JcKb8q3iqJ61gNV9KGb8thSsNjpSL0n8PARn9HuZOnIxN0hoP+VmmDGMN5t9UJ0Z" crossorigin="anonymous">
		
		<!-- needed for the small icons -->
		<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.8.1/css/all.css" integrity="sha384-50oBUHEmvpQ+1lW4y57PTFmhCaXp0ML5d60M1M7uH2+nqUivzIebhndOJK28anvf" crossorigin="anonymous">
        
		<!-- needed for the TODO add modal box -->
		<script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
		<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js" integrity="sha384-B4gt1jrGC7Jh4AgTPSdUtOBvfO8shuf57BaghqFfPlYxofvL8/KUEfYiJOMMV+rV" crossorigin="anonymous"></script>		
	</head>

	<body style="margin:10px">

		<!-- TODO item template -->	
		<template>
			<div class="card" id="0" style="display:none">
				<div class="card-body">
					<p class="card-text" style="font-size: 150%"></p>
					<button class="btn btn-lg btn-danger" 
				    	onclick="removeTodo(this)"><i class="fas fa-trash"></i> Remove
				    </button>
				    <button class="btn btn-lg btn-info" 
				    	onclick="setAsDone(this)"><i class="fas fa-check"></i> Set as DONE
				    </button>
				</div>
			</div>
		</template>
			
		<!-- DONE item template -->			
		<template>
			<div class="card" id="00" style="display:none">
				<div class="card-body">
					<p class="card-text" style="font-size: 150%"></p>
				    <button class="btn btn-lg btn-info" 
				    	onclick="setAsTodo(this)"><i class="fas fa-check"></i> Set as TODO
				    </button>
				</div>
			</div>
		</template>
		
		<!-- Modal to add TODO item -->
		<div class="modal fade" id="todoModal" tabindex="-1" role="dialog" aria-labelledby="todoModalLabel" aria-hidden="true">
			<div class="modal-dialog modal-lg" role="document">
				<div class="modal-content">
					<div class="modal-header">
						<h5 class="modal-title" id="todoModalLabel">Add new TODO item</h5>
						<button type="button" class="close" data-dismiss="modal" aria-label="Close">
		          			<span aria-hidden="true">&times;</span>
						</button>
					</div>
					<div class="modal-body">
						<textarea id="newTodoText" class="form-control" style="min-width: 100%" placeholder="Type TODO item text here..."></textarea>
					</div>
					<div class="modal-footer">
						<button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
						<button type="button" class="btn btn-primary" data-dismiss="modal" onclick="addTodo()">Add TODO</button>
					</div>
				</div>
			</div>
		</div>	
		
		<!-- Use two columns, one for TODO items, one for DONE items -->
		<div class="container">
			<div class="row">
				<div class="col"> 
					<h2>TODO</h2>
					<!-- Button to open TODO adding modal -->
					<button type="button" class="btn btn-lg btn-primary" data-toggle="modal" data-target="#todoModal">
						<i class="fas fa-plus"></i> Add TODO
					</button>
					<br><br>
					<!-- Container for TODO items -->
					<div id="todoItems">
					</div>
				</div>
				<div class="col">
					<h2>DONE</h2>
					<br><br><br>
					<!-- Container for DONE items -->							
					<div id="doneItems">
					</div>
				</div>
			</div>
		</div>
		
		<!-- javascript code -->
		<script type="text/javascript">
		
			function post(okFunction, failFunction, uri, data) {
			    var xhttp = new XMLHttpRequest();
			    xhttp.onreadystatechange = function() {
			        if (this.readyState > 3 && this.status == 200) {
			        	okFunction(this);
			        }
			        else if (this.readyState > 3 && this.status == 404) {
			            failFunction(this);
			        }			        
			    };
			    xhttp.open("POST", uri); 
			    //xhttp.withCredentials = true;
			    xhttp.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');
			    xhttp.send(data);
			}
			
			function getAllTodosCallback(data) {
				var obj;
				try {
					obj = JSON.parse(data.responseText);
				} catch (err) {
					console.log("Unable to parse JSON " + data.responseText);
					return;
				}
				var todoDiv = document.getElementById('todoItems');
				todoDiv.innerHTML = "";
				var doneDiv = document.getElementById('doneItems');
				doneDiv.innerHTML = "";
				for (var key in obj) {
					if (obj.hasOwnProperty(key)) {
						var type = obj[key].type;
						if (type === "todo") {
			    			var temp = document.getElementsByTagName("template")[0];
			    			var clone = temp.content.cloneNode(true);
			    			todoDiv.appendChild(clone);
			    			var cloneDiv = document.getElementById("0");
			    			// todo id goes here:
			    			cloneDiv.id = obj[key].id;
			    			cloneDiv.style.display = "block";
			    			// todo text content goes here:
			    			cloneDiv.getElementsByClassName('card-body')[0]
			    				.getElementsByClassName('card-text')[0]
			    				.innerHTML = obj[key].msg;
						}
						else { // done item
			    			var temp = document.getElementsByTagName("template")[1];
			    			var clone = temp.content.cloneNode(true);
			    			doneDiv.appendChild(clone);
			    			var cloneDiv = document.getElementById("00");
			    			// todo id goes here:
			    			cloneDiv.id = obj[key].id;
			    			cloneDiv.style.display = "block";
			    			// todo text content goes here:
			    			cloneDiv.getElementsByClassName('card-body')[0]
			    				.getElementsByClassName('card-text')[0]
			    				.innerHTML = obj[key].msg;							
						}
					}
				}	
			}

			function setAsDone(elem) {
				post(getAllTodosCallback, failCallback, "/setAsDone", "text=" + elem.parentNode.parentNode.id);
			}
			
			function setAsTodo(elem) {
				post(getAllTodosCallback, failCallback, "/setAsTodo", "text=" + elem.parentNode.parentNode.id);
			}			

			function removeTodo(elem) {
				post(getAllTodosCallback, failCallback, "/removeTodo", "text=" + elem.parentNode.parentNode.id);
			}			
			
			function addTodo() {
				var content = document.getElementById("newTodoText").value;
				post(getAllTodosCallback, failCallback, "/addTodo", "text=" + encodeURIComponent(content));
			}
			
			
			function failCallback() {
				alert("failed");
			}
			
			// self executing function here
			(function() {
				post(getAllTodosCallback, failCallback, "/getAllTodos", "");
			})();
			
		</script>
	</body>
</html>